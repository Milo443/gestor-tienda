{% extends "base.html" %}

{% block title %}Factura{% endblock %}

{% block content %}

{% load static %}
{% load humanize %}


<div class="container mt-5">
    <h1 class="">Facturacion</h1>
    <form action="{%url 'form_venta'%}" method="POST">
        {% csrf_token %}
        {% comment %} <div class="row">
            <div class="col-md-9">
                <div class="form-group">
                    <label for="cliente">Cliente</label>
                    <select name="cliente" id="cliente" class="form-control" data-show-subtext="true" data-live-search="true">
                        
                        <option value="">Seleccione un cliente</option>
                        {% for cliente in clientes %}
                        <option value="{{cliente.id}}">{{cliente.nombre}} {{cliente.apellidos}}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="fecha">Fecha</label>
                    <input type="date" name="fecha" id="fecha" class="form-control">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <label for="observaciones">Observacion:</label>
                    <input type="text" name="observaciones" id="observaciones" class="form-control">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <div class="form-check">
                        <input type="checkbox" name="pago_contra_entrega" id="pago_contra_entrega" class="form-check-input">
                        <label class="form-check-label" for="pago_contra_entrega">Pago Contra-entrega</label>
                    </div>
                </div>
            </div>
        </div> {% endcomment %}

        {{ venta_form.as_p }}

        <h3>Productos</h3>
        {{ detalle_formset.management_form }}
       
            <div class="detalle-forms">
                {% for form in detalle_formset %}
                <div class="detalle-form">
                    {{form.as_p}}
                </div>
                {% endfor %}
            </div>
            

        
        <button type="button" id="add-detalle" class="btn btn-primary">Agregar Producto</button>

        <button type="submit" class="btn btn-primary">Guardar</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        console.log('DOM cargado');
        const addDetalleBtn = document.getElementById('add-detalle');
        const detalleForms = document.querySelector('.detalle-forms');
        const totalForms = document.querySelector('id_detalle_form-TOTAL_FORMS');

        addDetalleBtn.addEventListener('click', () => {
            console.log('click');
            const currentFormCount = detalleForms.children.length;
            const newForm = detalleForms.children[0].cloneNode(true);
            const formRegex = RegExp(`id_detalle_form-(\\d){1}-`, 'g');

            newForm.innerHTML = newForm.innerHTML.replace(formRegex, `id_detalle_form-${currentFormCount}-`);
            detalleForms.appendChild(newForm);
            totalForms.setAttribute('value', `${currentFormCount + 1}`);
            
        });
    });
</script>

{% endblock %}

